[directus](../README.md) / [Modules](../modules.md) / [services](../modules/services.md) / GraphQLService

# Class: GraphQLService

[services](../modules/services.md).GraphQLService

## Table of contents

### Constructors

- [constructor](services.GraphQLService.md#constructor)

### Properties

- [accountability](services.GraphQLService.md#accountability)
- [knex](services.GraphQLService.md#knex)
- [schema](services.GraphQLService.md#schema)
- [scope](services.GraphQLService.md#scope)

### Methods

- [execute](services.GraphQLService.md#execute)
- [formatError](services.GraphQLService.md#formaterror)
- [getAggregateQuery](services.GraphQLService.md#getaggregatequery)
- [getQuery](services.GraphQLService.md#getquery)
- [getSchema](services.GraphQLService.md#getschema)
- [getService](services.GraphQLService.md#getservice)
- [injectSystemResolvers](services.GraphQLService.md#injectsystemresolvers)
- [parseArgs](services.GraphQLService.md#parseargs)
- [read](services.GraphQLService.md#read)
- [replaceFragmentsInSelections](services.GraphQLService.md#replacefragmentsinselections)
- [replaceFuncs](services.GraphQLService.md#replacefuncs)
- [resolveMutation](services.GraphQLService.md#resolvemutation)
- [resolveQuery](services.GraphQLService.md#resolvequery)
- [upsertSingleton](services.GraphQLService.md#upsertsingleton)

## Constructors

### constructor

• **new GraphQLService**(`options`)

#### Parameters

| Name | Type |
| :------ | :------ |
| `options` | `AbstractServiceOptions` & { `scope`: ``"items"`` \| ``"system"``  } |

#### Defined in

[api/src/services/graphql/index.ts:119](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L119)

## Properties

### accountability

• **accountability**: `any`

#### Defined in

[api/src/services/graphql/index.ts:114](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L114)

___

### knex

• **knex**: `Knex`<`any`, `any`[]\>

#### Defined in

[api/src/services/graphql/index.ts:115](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L115)

___

### schema

• **schema**: `SchemaOverview`

#### Defined in

[api/src/services/graphql/index.ts:116](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L116)

___

### scope

• **scope**: ``"items"`` \| ``"system"``

#### Defined in

[api/src/services/graphql/index.ts:117](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L117)

## Methods

### execute

▸ **execute**(`«destructured»`): `Promise`<`FormattedExecutionResult`<`ObjMap`<`unknown`\>, `ObjMap`<`unknown`\>\>\>

Execute a GraphQL structure

#### Parameters

| Name | Type |
| :------ | :------ |
| `«destructured»` | `GraphQLParams` |

#### Returns

`Promise`<`FormattedExecutionResult`<`ObjMap`<`unknown`\>, `ObjMap`<`unknown`\>\>\>

#### Defined in

[api/src/services/graphql/index.ts:129](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L129)

___

### formatError

▸ **formatError**(`error`): `GraphQLError`

Convert Directus-Exception into a GraphQL format, so it can be returned by GraphQL properly.

#### Parameters

| Name | Type |
| :------ | :------ |
| `error` | `any` |

#### Returns

`GraphQLError`

#### Defined in

[api/src/services/graphql/index.ts:1704](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1704)

___

### getAggregateQuery

▸ **getAggregateQuery**(`rawQuery`, `selections`): `Query`

Resolve the aggregation query based on the requested aggregated fields

#### Parameters

| Name | Type |
| :------ | :------ |
| `rawQuery` | `Query` |
| `selections` | readonly `SelectionNode`[] |

#### Returns

`Query`

#### Defined in

[api/src/services/graphql/index.ts:1644](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1644)

___

### getQuery

▸ **getQuery**(`rawQuery`, `selections`, `variableValues`): `Query`

Get a Directus Query object from the parsed arguments (rawQuery) and GraphQL AST selectionSet. Converts SelectionSet into
Directus' `fields` query for use in the resolver. Also applies variables where appropriate.

#### Parameters

| Name | Type |
| :------ | :------ |
| `rawQuery` | `Query` |
| `selections` | readonly `SelectionNode`[] |
| `variableValues` | `Object` |

#### Returns

`Query`

#### Defined in

[api/src/services/graphql/index.ts:1518](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1518)

___

### getSchema

▸ **getSchema**(): `GraphQLSchema`

Generate the GraphQL schema. Pulls from the schema information generated by the get-schema util.

#### Returns

`GraphQLSchema`

#### Defined in

[api/src/services/graphql/index.ts:170](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L170)

▸ **getSchema**(`type`): `GraphQLSchema`

#### Parameters

| Name | Type |
| :------ | :------ |
| `type` | ``"schema"`` |

#### Returns

`GraphQLSchema`

#### Defined in

[api/src/services/graphql/index.ts:171](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L171)

▸ **getSchema**(`type`): `string` \| `GraphQLSchema`

#### Parameters

| Name | Type |
| :------ | :------ |
| `type` | ``"sdl"`` |

#### Returns

`string` \| `GraphQLSchema`

#### Defined in

[api/src/services/graphql/index.ts:172](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L172)

___

### getService

▸ **getService**(`collection`): [`ItemsService`](services.ItemsService.md)<`Item`\>

Select the correct service for the given collection. This allows the individual services to run
their custom checks (f.e. it allows UsersService to prevent updating TFA secret from outside)

#### Parameters

| Name | Type |
| :------ | :------ |
| `collection` | `string` |

#### Returns

[`ItemsService`](services.ItemsService.md)<`Item`\>

#### Defined in

[api/src/services/graphql/index.ts:1717](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1717)

___

### injectSystemResolvers

▸ **injectSystemResolvers**(`schemaComposer`, `«destructured»`, `schema`): `SchemaComposer`<`any`\>

#### Parameters

| Name | Type |
| :------ | :------ |
| `schemaComposer` | `SchemaComposer`<{ `req?`: `Request`<`ParamsDictionary`, `any`, `any`, `ParsedQs`, `Record`<`string`, `any`\>\> ; `res?`: `Response`<`any`, `Record`<`string`, `any`\>\>  }\> |
| `«destructured»` | `Object` |
| › `CreateCollectionTypes` | `Record`<`string`, `ObjectTypeComposer`<`any`, `any`\>\> |
| › `DeleteCollectionTypes` | `Record`<`string`, `ObjectTypeComposer`<`any`, `any`\>\> |
| › `ReadCollectionTypes` | `Record`<`string`, `ObjectTypeComposer`<`any`, `any`\>\> |
| › `UpdateCollectionTypes` | `Record`<`string`, `ObjectTypeComposer`<`any`, `any`\>\> |
| `schema` | `Object` |
| `schema.create` | `SchemaOverview` |
| `schema.delete` | `SchemaOverview` |
| `schema.read` | `SchemaOverview` |
| `schema.update` | `SchemaOverview` |

#### Returns

`SchemaComposer`<`any`\>

#### Defined in

[api/src/services/graphql/index.ts:1790](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1790)

___

### parseArgs

▸ **parseArgs**(`args`, `variableValues`): `Record`<`string`, `any`\>

GraphQL's regular resolver `args` variable only contains the "top-level" arguments. Seeing that we convert the
whole nested tree into one big query using Directus' own query resolver, we want to have a nested structure of
arguments for the whole resolving tree, which can later be transformed into Directus' AST using `deep`.
In order to do that, we'll parse over all ArgumentNodes and ObjectFieldNodes to manually recreate an object structure
of arguments

#### Parameters

| Name | Type |
| :------ | :------ |
| `args` | readonly `ArgumentNode`[] |
| `variableValues` | `Object` |

#### Returns

`Record`<`string`, `any`\>

#### Defined in

[api/src/services/graphql/index.ts:1483](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1483)

___

### read

▸ **read**(`collection`, `query`): `Promise`<`Partial`<`Item`\>\>

Execute the read action on the correct service. Checks for singleton as well.

#### Parameters

| Name | Type |
| :------ | :------ |
| `collection` | `string` |
| `query` | `Query` |

#### Returns

`Promise`<`Partial`<`Item`\>\>

#### Defined in

[api/src/services/graphql/index.ts:1442](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1442)

___

### replaceFragmentsInSelections

▸ **replaceFragmentsInSelections**(`selections`, `fragments`): ``null`` \| readonly `SelectionNode`[]

Replace all fragments in a selectionset for the actual selection set as defined in the fragment
Effectively merges the selections with the fragments used in those selections

#### Parameters

| Name | Type |
| :------ | :------ |
| `selections` | `undefined` \| readonly `SelectionNode`[] |
| `fragments` | `Record`<`string`, `FragmentDefinitionNode`\> |

#### Returns

``null`` \| readonly `SelectionNode`[]

#### Defined in

[api/src/services/graphql/index.ts:1762](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1762)

___

### replaceFuncs

▸ **replaceFuncs**(`filter?`): `any`

Replace functions from GraphQL format to Directus-Filter format

#### Parameters

| Name | Type |
| :------ | :------ |
| `filter?` | `any` |

#### Returns

`any`

#### Defined in

[api/src/services/graphql/index.ts:1679](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1679)

___

### resolveMutation

▸ **resolveMutation**(`args`, `info`): `Promise`<`undefined` \| `boolean` \| `Partial`<`Item`\>\>

#### Parameters

| Name | Type |
| :------ | :------ |
| `args` | `Record`<`string`, `any`\> |
| `info` | `GraphQLResolveInfo` |

#### Returns

`Promise`<`undefined` \| `boolean` \| `Partial`<`Item`\>\>

#### Defined in

[api/src/services/graphql/index.ts:1364](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1364)

___

### resolveQuery

▸ **resolveQuery**(`info`): `Promise`<``null`` \| `Partial`<`Item`\>\>

Generic resolver that's used for every "regular" items/system query. Converts the incoming GraphQL AST / fragments into
Directus' query structure which is then executed by the services.

#### Parameters

| Name | Type |
| :------ | :------ |
| `info` | `GraphQLResolveInfo` |

#### Returns

`Promise`<``null`` \| `Partial`<`Item`\>\>

#### Defined in

[api/src/services/graphql/index.ts:1302](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1302)

___

### upsertSingleton

▸ **upsertSingleton**(`collection`, `body`, `query`): `Promise`<`boolean` \| `Partial`<`Item`\>\>

Upsert and read singleton item

#### Parameters

| Name | Type |
| :------ | :------ |
| `collection` | `string` |
| `body` | `Record`<`string`, `any`\> \| `Record`<`string`, `any`\>[] |
| `query` | `Query` |

#### Returns

`Promise`<`boolean` \| `Partial`<`Item`\>\>

#### Defined in

[api/src/services/graphql/index.ts:1455](https://github.com/directus/directus/blob/9368dbd0c/api/src/services/graphql/index.ts#L1455)
